<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>vcExpense Tracker</title>

<style>
  body { margin:0; font-family:system-ui,sans-serif; background:#f6f7f8; padding:12px; }
  h2 { margin:8px 0; font-size:18px; }
  .controls { display:flex; gap:8px; margin-bottom:10px; }
  button { flex:1; padding:10px; border-radius:8px; border:none; font-size:14px; background:#1f2937; color:#fff; }
  .secondary { background:#6b7280; }
  .container { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
  .column { background:#fff; border-radius:12px; padding:10px; }
  .expense { background:#f1f3f5; border-radius:8px; padding:8px; margin-bottom:6px; font-size:13px; position:relative; }
  .amount { font-weight:600; }
  .actions { position:absolute; top:6px; right:6px; display:flex; gap:6px; }
  .actions span { cursor:pointer; font-size:12px; color:#374151; }
  .total { font-weight:700; margin-top:6px; }
  .grand { margin-top:12px; background:#111827; color:#fff; padding:10px; border-radius:10px; font-weight:700; text-align:center; }
  .footer { margin-top:12px; text-align:center; font-size:12px; color:#555; }

  .modal { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:none; align-items:center; justify-content:center; }
  .modal-content { background:#fff; width:90%; max-width:320px; border-radius:12px; padding:14px; }
  .modal-content input, .modal-content select { width:100%; padding:10px; margin-bottom:8px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
  .modal-actions { display:flex; gap:8px; }
</style>
</head>
<body>

<div class="controls">
  <button onclick="openModal()">+ Add / Edit</button>
  <button onclick="document.getElementById('importFile').click()">‚¨Ü Import</button>
  <button onclick="exportCSV()">‚¨á Export</button>
</div>
<input type="file" id="importFile" accept=".csv" style="display:none" onchange="importCSV(event)" />

<div class="container">
  <div class="column">
    <h2>One-time Expenses</h2>
    <div id="oneTimeList"></div>
    <div class="total">Total: ‚Çπ<span id="oneTimeTotal">0</span></div>
  </div>
  <div class="column">
    <h2>Recurring (Batch-wise)</h2>
    <div id="recurringList"></div>
    <div class="total">Total (All Batches): ‚Çπ<span id="recurringTotal">0</span></div>
  </div>
</div>

<div class="grand">Grand Total: ‚Çπ<span id="grandTotal">0</span></div>

<div class="footer">Data stored locally on this device</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <input type="date" id="date" />
    <input type="text" id="desc" placeholder="Expense for / whom" />
    <input type="number" id="amt" placeholder="Amount" />
    <select id="type">
      <option value="oneTime">One-time</option>
      <option value="recurring">Recurring</option>
    </select>
    <input type="hidden" id="editId" />
    <div class="modal-actions">
      <button onclick="saveExpense()">Save</button>
      <button class="secondary" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
let expenses = JSON.parse(localStorage.getItem('expenses')) || [];

function openModal(exp=null) {
  document.getElementById('date').value = exp?.date || new Date().toISOString().slice(0,10);
  document.getElementById('desc').value = exp?.desc || '';
  document.getElementById('amt').value = exp?.amt || '';
  document.getElementById('type').value = exp?.type || 'oneTime';
  document.getElementById('editId').value = exp?.id || '';
  document.getElementById('modal').style.display='flex';
}
function closeModal(){ document.getElementById('modal').style.display='none'; }

function saveExpense(){
  const date=document.getElementById('date').value;
  const desc=document.getElementById('desc').value.trim();
  const amt=parseFloat(document.getElementById('amt').value);
  const type=document.getElementById('type').value;
  const id=document.getElementById('editId').value;
  if(!date||!desc||isNaN(amt)) return;
  if(id){
    const e=expenses.find(x=>x.id===id);
    Object.assign(e,{date,desc,amt,type});
  } else {
    expenses.push({id:crypto.randomUUID(),date,desc,amt,type});
  }
  persist(); closeModal();
}

function deleteExpense(id){ if(confirm('Delete this expense?')){ expenses=expenses.filter(e=>e.id!==id); persist(); } }

function persist(){
  expenses.sort((a,b)=>b.date.localeCompare(a.date));
  localStorage.setItem('expenses',JSON.stringify(expenses));
  render();
}

function render(){
  const one=document.getElementById('oneTimeList');
  const rec=document.getElementById('recurringList');
  one.innerHTML=''; rec.innerHTML='';

  let ot=0, rt=0;
  const batches = {};

  expenses.forEach(e=>{
    if(typeof e.amt !== 'number' || isNaN(e.amt)) return;

    if(e.type==='oneTime'){
      ot += e.amt;
      const d=document.createElement('div'); d.className='expense';
      d.innerHTML=`<div>${e.date}</div><div>${e.desc}</div><div class='amount'>‚Çπ${e.amt}</div><div class='actions'><span onclick='openModal(${JSON.stringify(e)})'>‚úèÔ∏è</span><span onclick='deleteExpense("${e.id}")'>üóë</span></div>`;
      one.appendChild(d);
    } else {
      const batch = e.batch || 'Batch 1';
      batches[batch] = batches[batch] || { total:0, items:[] };
      batches[batch].total += e.amt;
      batches[batch].items.push(e);
      rt += e.amt;
    }
  });

  Object.keys(batches).sort().forEach(batch=>{
    const header=document.createElement('div');
    header.className='total';
    header.textContent=`${batch} ‚Äî ‚Çπ${batches[batch].total}`;
    rec.appendChild(header);

    batches[batch].items.forEach(e=>{
      const d=document.createElement('div'); d.className='expense';
      d.innerHTML=`<div>${e.date}</div><div>${e.desc}</div><div class='amount'>‚Çπ${e.amt}</div><div class='actions'><span onclick='openModal(${JSON.stringify(e)})'>‚úèÔ∏è</span><span onclick='deleteExpense("${e.id}")'>üóë</span></div>`;
      rec.appendChild(d);
    });
  });

  document.getElementById('oneTimeTotal').textContent=ot;
  document.getElementById('recurringTotal').textContent=rt;
  document.getElementById('grandTotal').textContent=ot+rt;
}

function exportCSV(){
  if(!expenses.length) return alert('No expenses');
  let csv='Date,Type,Description,Amount\n';
  expenses.forEach(e=>csv+=`${e.date},${e.type},${e.desc},${e.amt}\n`);
  const b=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(b);
  a.download='vc_expenses.csv'; a.click();
}

function importCSV(evt){
  const file=evt.target.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=()=>{
    const rows=r.result.trim().split(/\r?\n/).slice(1);
    rows.forEach(line=>{
      const [date,type,desc,amt]=line.split(',');
      const existing=expenses.find(e=>e.date===date&&e.desc===desc&&e.type===type);
      if(existing) existing.amt=parseFloat(amt);
      else expenses.push({id:crypto.randomUUID(),date,desc,amt:parseFloat(amt),type});
    });
    persist();
  };
  r.readAsText(file);
}

persist();
</script>
</body>
</html>
